<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ - –ü—Ä–æ—Ñ–∏–®–∏–Ω–∞</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="logo">–ü—Ä–æ—Ñ–∏–®–∏–Ω–∞<span class="logo-accent">.RU</span></div>
        <nav>
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="admin.html" class="active">–ê–¥–º–∏–Ω–∫–∞</a>
        </nav>
        <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
    </header>

    <div class="admin-container">
        <div class="admin-section">
            <div class="admin-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <button class="btn btn-add" onclick="openUserModal()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–ò–º—è</th>
                        <th>–†–æ–ª—å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>admin</td>
                        <td>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</td>
                        <td><span class="role-badge role-admin">–ê–¥–º–∏–Ω</span></td>
                        <td>
                            <button class="btn btn-edit" onclick="editUser(1)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-delete" onclick="deleteUser(1)">–£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>user1</td>
                        <td>–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</td>
                        <td><span class="role-badge role-user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span></td>
                        <td>
                            <button class="btn btn-edit" onclick="editUser(2)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-delete" onclick="deleteUser(2)">–£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="admin-section">
            <div class="admin-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
                <button class="btn btn-add" onclick="openProductModal()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Nokian Hakkapelitta R3</td>
                        <td>9 990 ‚ÇΩ</td>
                        <td>
                            <button class="btn btn-edit" onclick="editProduct(1)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-delete" onclick="deleteProduct(1)">–£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Bridgestone Blizzak</td>
                        <td>8 490 ‚ÇΩ</td>
                        <td>
                            <button class="btn btn-edit" onclick="editProduct(2)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-delete" onclick="deleteProduct(2)">–£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="userModal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="userModalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <button class="close-modal" onclick="closeUserModal()">√ó</button>
            </div>
            <div class="admin-modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    <div class="form-group">
                        <label for="userLogin">–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="userLogin" required>
                    </div>
                    <div class="form-group">
                        <label for="userPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="userPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="userName">–ò–º—è:</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userRole">–†–æ–ª—å:</label>
                        <select id="userRole">
                            <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeUserModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-add" onclick="saveUser()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="productAdminModal" class="admin-modal tall-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="productModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                <button class="close-modal" onclick="closeProductModal()">√ó</button>
            </div>
            <div class="admin-modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    <div class="form-group">
                        <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="productName" value="Nokian Hakkapelitta R3" required>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea id="productDescription" rows="3">–ó–∏–º–Ω—è—è —à–∏–Ω–∞ –¥–ª—è —Å—É—Ä–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π</textarea>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">–¶–µ–Ω–∞:</label>
                        <input type="number" id="productPrice" value="9990" required>
                    </div>
                    
                    <input type="hidden" id="productImage" name="image">
                    
                    <div class="form-group">
                        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</label>
                        <div class="image-upload-section">
                            <div class="url-display" id="currentUrlDisplay">
                                –¢–µ–∫—É—â–∏–π URL: <span id="currentUrlText">–Ω–µ —É–∫–∞–∑–∞–Ω</span>
                            </div>
                            
                            <div class="upload-options">
                                <button type="button" class="btn-upload-local" onclick="openLocalUpload()">
                                    üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
                                </button>
                                <button type="button" class="btn-upload-cloud" onclick="openCloudUpload()">
                                    ‚òÅÔ∏è –ò–∑ –æ–±–ª–∞–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                                </button>
                            </div>
                            
                            <div id="localUploadSection" class="local-upload-section" style="display: none;">
                                <h4>–ó–∞–≥—Ä—É–∑–∫–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞</h4>
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-placeholder" id="uploadPlaceholder">
                                        <span class="upload-icon">üìÅ</span>
                                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞ –∏–ª–∏</p>
                                        <button type="button" class="btn-browse" onclick="document.getElementById('fileInput').click()">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</button>
                                        <p class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF (–º–∞–∫—Å. 5MB)</p>
                                    </div>
                                    <div class="upload-preview" id="uploadPreview" style="display: none;">
                                        <img id="previewImage" src="" alt="–ü—Ä–µ–≤—å—é">
                                        <div class="upload-info">
                                            <span id="fileName"></span>
                                            <button type="button" class="btn-remove" onclick="removeUploadedImage()">‚úï</button>
                                        </div>
                                    </div>
                                </div>
                                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                            </div>
                            
                            <div id="cloudUploadSection" class="cloud-upload-section" style="display: none;">
                                <h4>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –æ–±–ª–∞–∫–∞ Mail.ru</h4>
                                <div class="cloud-instructions">
                                    <p><strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É:</strong></p>
                                    <p>1. –í –æ–±–ª–∞–∫–µ Mail.ru –Ω–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª</p>
                                    <p>2. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ‚Üí "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É"</p>
                                    <p>3. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ:</p>
                                </div>
                                <input type="text" id="cloudImageUrl" 
                                       placeholder="https://cloud.mail.ru/public/..." 
                                       class="cloud-url-input">
                                <button type="button" class="btn-confirm-cloud" onclick="confirmCloudImage()">
                                    ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                </button>
                                <div class="cloud-tips">
                                    <p><small>–ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:</small></p>
                                    <p><small>‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –ø—É–±–ª–∏—á–Ω–∞—è</small></p>
                                    <p><small>‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small></p>
                                </div>
                            </div>
                            
                            <div id="imagePreview" class="image-preview">
                                <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeProductModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-add" onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>

    <script>
        function openUserModal() {
            document.getElementById('userModal').style.display = 'block';
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        function openProductModal() {
            document.getElementById('productAdminModal').style.display = 'block';
            updateUrlDisplay();
        }

        function closeProductModal() {
            document.getElementById('productAdminModal').style.display = 'none';
            hideCloudSection();
            hideLocalSection();
        }

        function saveUser() {
            const login = document.getElementById('userLogin').value;
            const password = document.getElementById('userPassword').value;
            const name = document.getElementById('userName').value;
            const role = document.getElementById('userRole').value;
            
            alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω:\n–õ–æ–≥–∏–Ω: ${login}\n–ò–º—è: ${name}\n–†–æ–ª—å: ${role}`);
            closeUserModal();
        }

        function saveProduct() {
            const name = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const price = document.getElementById('productPrice').value;
            const image = document.getElementById('productImage').value;
            
            alert(`–¢–æ–≤–∞—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω:\n–ù–∞–∑–≤–∞–Ω–∏–µ: ${name}\n–¶–µ–Ω–∞: ${price} —Ä—É–±.\n–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${image ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'}`);
            closeProductModal();
        }

        function openLocalUpload() {
            document.getElementById('localUploadSection').style.display = 'block';
            document.getElementById('cloudUploadSection').style.display = 'none';
            initDragAndDrop();
        }

        function openCloudUpload() {
            document.getElementById('cloudUploadSection').style.display = 'block';
            document.getElementById('localUploadSection').style.display = 'none';
        }

        function hideCloudSection() {
            document.getElementById('cloudUploadSection').style.display = 'none';
            document.getElementById('cloudImageUrl').value = '';
        }

        function hideLocalSection() {
            document.getElementById('localUploadSection').style.display = 'none';
        }

        function confirmCloudImage() {
            const cloudUrl = document.getElementById('cloudImageUrl').value.trim();
            
            if (!cloudUrl) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }

            document.getElementById('productImage').value = cloudUrl;
            updateImagePreview(cloudUrl);
            hideCloudSection();
            updateUrlDisplay();
            alert('‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        function initDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            if (!uploadArea || !fileInput) return;
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files[0]) {
                    handleFileSelect(e.target.files[0]);
                }
            });
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    handleFileSelect(file);
                } else {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG, GIF)');
                }
            });
        }

        function handleFileSelect(file) {
            if (!file || !file.type.startsWith('image/')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG, GIF)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const imageDataUrl = e.target.result;
                
                showUploadPreview(file.name, imageDataUrl);
                document.getElementById('productImage').value = imageDataUrl;
                updateImagePreview(imageDataUrl);
                updateUrlDisplay();
                
                alert('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞!');
            };
            
            reader.readAsDataURL(file);
        }

        function showUploadPreview(fileName, imageUrl) {
            const uploadArea = document.getElementById('uploadArea');
            const uploadPreview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('previewImage');
            const fileNameSpan = document.getElementById('fileName');
            
            if (!uploadArea || !uploadPreview || !previewImage || !fileNameSpan) return;
            
            previewImage.src = imageUrl;
            fileNameSpan.textContent = fileName;
            
            const uploadPlaceholder = uploadArea.querySelector('.upload-placeholder');
            if (uploadPlaceholder) {
                uploadPlaceholder.style.display = 'none';
            }
            uploadPreview.style.display = 'block';
        }

        function removeUploadedImage() {
            const uploadArea = document.getElementById('uploadArea');
            const uploadPreview = document.getElementById('uploadPreview');
            
            if (!uploadArea || !uploadPreview) return;
            
            uploadPreview.style.display = 'none';
            const uploadPlaceholder = uploadArea.querySelector('.upload-placeholder');
            if (uploadPlaceholder) {
                uploadPlaceholder.style.display = 'block';
            }
            
            document.getElementById('productImage').value = '';
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.value = '';
            }
            updateImagePreview('');
            updateUrlDisplay();
        }

        function updateImagePreview(imageUrl) {
            const preview = document.getElementById('imagePreview');
            if (imageUrl) {
                const img = new Image();
                img.onload = function() {
                    preview.innerHTML = `<img src="${imageUrl}" alt="–ü—Ä–µ–≤—å—é" style="max-width: 100%; max-height: 200px; border-radius: 4px;">`;
                };
                img.onerror = function() {
                    preview.innerHTML = `
                        <p style="color: #dc3545;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                        <p><small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏</small></p>
                    `;
                };
                img.src = imageUrl;
            } else {
                preview.innerHTML = '<p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
            }
        }

        function updateUrlDisplay() {
            const currentUrl = document.getElementById('productImage').value;
            const urlDisplay = document.getElementById('currentUrlText');
            
            if (currentUrl) {
                urlDisplay.textContent = currentUrl.length > 50 ? 
                    currentUrl.substring(0, 50) + '...' : currentUrl;
            } else {
                urlDisplay.textContent = '–Ω–µ —É–∫–∞–∑–∞–Ω';
            }
        }

        function editUser(id) {
            document.getElementById('userModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
            document.getElementById('userId').value = id;
            document.getElementById('userLogin').value = 'admin';
            document.getElementById('userPassword').value = '';
            document.getElementById('userName').value = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            document.getElementById('userRole').value = 'admin';
            openUserModal();
        }

        function deleteUser(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω (–∑–∞–≥–ª—É—à–∫–∞)');
            }
        }

        function editProduct(id) {
            document.getElementById('productModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
            document.getElementById('productId').value = id;
            openProductModal();
        }

        function deleteProduct(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
                alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω (–∑–∞–≥–ª—É—à–∫–∞)');
            }
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            initDragAndDrop();
        });
    </script>
</body>
</html>